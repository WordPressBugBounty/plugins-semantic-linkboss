"use strict";(globalThis.webpackChunksemantic_linkboss=globalThis.webpackChunksemantic_linkboss||[]).push([[866],{6866:(e,t,s)=>{s.r(t),s.d(t,{default:()=>f});var r=s(1609),n=s(7723),a=s(1083),o=s(8465),i=s.n(o),c=function(e,t){return c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var s in t)t.hasOwnProperty(s)&&(e[s]=t[s])},c(e,t)};function l(e){var t=e.className,s=e.counterClockwise,n=e.dashRatio,a=e.pathRadius,o=e.strokeWidth,i=e.style;return(0,r.createElement)("path",{className:t,style:Object.assign({},i,u({pathRadius:a,dashRatio:n,counterClockwise:s})),d:d({pathRadius:a,counterClockwise:s}),strokeWidth:o,fillOpacity:0})}function d(e){var t=e.pathRadius,s=e.counterClockwise?1:0;return"\n      M 50,50\n      m 0,-"+t+"\n      a "+t+","+t+" "+s+" 1 1 0,"+2*t+"\n      a "+t+","+t+" "+s+" 1 1 0,-"+2*t+"\n    "}function u(e){var t=e.counterClockwise,s=e.dashRatio,r=e.pathRadius,n=2*Math.PI*r,a=(1-s)*n;return{strokeDasharray:n+"px "+n+"px",strokeDashoffset:(t?-a:a)+"px"}}var p=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return function(e,t){function __(){this.constructor=e}c(e,t),e.prototype=null===t?Object.create(t):(__.prototype=t.prototype,new __)}(t,e),t.prototype.getBackgroundPadding=function(){return this.props.background?this.props.backgroundPadding:0},t.prototype.getPathRadius=function(){return 50-this.props.strokeWidth/2-this.getBackgroundPadding()},t.prototype.getPathRatio=function(){var e=this.props,t=e.value,s=e.minValue,r=e.maxValue;return(Math.min(Math.max(t,s),r)-s)/(r-s)},t.prototype.render=function(){var e=this.props,t=e.circleRatio,s=e.className,n=e.classes,a=e.counterClockwise,o=e.styles,i=e.strokeWidth,c=e.text,d=this.getPathRadius(),u=this.getPathRatio();return(0,r.createElement)("svg",{className:n.root+" "+s,style:o.root,viewBox:"0 0 100 100","data-test-id":"CircularProgressbar"},this.props.background?(0,r.createElement)("circle",{className:n.background,style:o.background,cx:50,cy:50,r:50}):null,(0,r.createElement)(l,{className:n.trail,counterClockwise:a,dashRatio:t,pathRadius:d,strokeWidth:i,style:o.trail}),(0,r.createElement)(l,{className:n.path,counterClockwise:a,dashRatio:u*t,pathRadius:d,strokeWidth:i,style:o.path}),c?(0,r.createElement)("text",{className:n.text,style:o.text,x:50,y:50},c):null)},t.defaultProps={background:!1,backgroundPadding:0,circleRatio:1,classes:{root:"CircularProgressbar",trail:"CircularProgressbar-trail",path:"CircularProgressbar-path",text:"CircularProgressbar-text",background:"CircularProgressbar-background"},counterClockwise:!1,className:"",maxValue:100,minValue:0,strokeWidth:8,styles:{root:{},trail:{},path:{},text:{},background:{}},text:""},t}(r.Component);function m(e){return Object.keys(e).forEach(function(t){null==e[t]&&delete e[t]}),e}var g=s(513),h=s(982),y=s(6188);const f=({isWizard:e=!1})=>{const{resetQuery:t}=(0,r.useContext)(g.B),{triggerRefresh:s}=(0,r.useContext)(g.B),[o,c]=(0,r.useState)(!1),[l,d]=(0,r.useState)([]),[u,f]=(0,r.useState)([]),[k,b]=(0,r.useState)(0),[_,x]=(0,r.useState)(!1),[w,C]=(0,r.useState)(0),[v,E]=(0,r.useState)(()=>"true"!==localStorage.getItem("linkboss_sync_complete_banner_dismissed")),P=async t=>{try{const r=await a.A.post(LinkBossConfig?.rest_url+"linkboss/v1/sync",{action:"prepare_batch_for_sync"},{headers:{"X-WP-Nonce":LinkBossConfig.nonce}});if(e||s(),400===r?.data?.data?.srv_status?.status)return void i().fire({icon:"error",title:"Error",html:r?.data?.data?.srv_status?.msg});if("yes"===r?.data?.data?.has_batch){const e=await a.A.post(LinkBossConfig?.rest_url+"linkboss/v1/init",{action:"init_batch_reports",who:"syncPosts"},{headers:{"X-WP-Nonce":LinkBossConfig.nonce}}),s="urls"===e?.data?.reports?.sync_method,n=s?e?.data?.reports?.urls:0;if(s&&n>0){const t=(e?.data?.reports?.sync_done||0)/n*100;b(Math.round(100*t)/100)}else{let e=(t-r?.data?.data?.batch_length)/t*100;b(Math.round(100*e)/100)}await P(t)}else d(e=>[...e,"Sync Completed"]),b(100),N()}catch(e){i().fire({icon:"error",title:"Error",text:"Error preparing queue. Please try again."}),console.error("Error preparing queue:",e)}},N=async()=>{try{const t=await a.A.post(LinkBossConfig?.rest_url+"linkboss/v1/sync",{action:"sync_finish"},{headers:{"X-WP-Nonce":LinkBossConfig.nonce}});"success"===t?.data?.status?(d(e=>[...e,"Category Sync Finished","Syncing Finished"]),d(e=>[...e,"Sync Finished"]),i().fire({icon:"success",title:(0,n.__)("Sync Completed Successfully! ðŸŽ‰","semantic-linkboss"),html:`\n            <p class="mb-4" style="font-size: 15px; color: #4b5563;">\n              ${(0,n.__)("Your content has been synced to LinkBoss. Ready to build internal links?","semantic-linkboss")}\n            </p>\n            <p style="font-size: 14px; color: #6b7280;">\n              ${(0,n.__)("All link building features are available in the LinkBoss App.","semantic-linkboss")}\n            </p>\n          `,showCancelButton:!0,confirmButtonColor:"#3b82f6",cancelButtonColor:"#6b7280",confirmButtonText:(0,n.__)("Open LinkBoss App","semantic-linkboss"),cancelButtonText:(0,n.__)("Stay Here","semantic-linkboss")}).then(e=>{e.isConfirmed?window.open("https://app.linkboss.io/app/sites","_blank"):e.isDismissed&&window.location.reload()}),C(!0),"true"!==localStorage.getItem("linkboss_sync_complete_banner_dismissed")&&E(!0),e&&setTimeout(()=>{localStorage.setItem("linkboss_setup_wizard_step",2)},1500),s()):i().fire({icon:"error",title:t?.data?.title,html:t?.data?.message})}catch(e){console.error("Error finishing sync:",e)}};return(0,r.useEffect)(()=>{(async()=>{try{const e=await a.A.post(LinkBossConfig?.rest_url+"linkboss/v1/init",{action:"init_batch_reports",who:"syncPosts-2"},{headers:{"X-WP-Nonce":LinkBossConfig.nonce}});let t=e?.data?.reports?.sync_done,s=e?.data?.reports?.sync_remaing,r=t/(t+s)*100||0;o||b(Math.round(100*r)/100),f(e?.data?.reports)}catch(e){throw console.error("Error fetching reports:",e),e}})()},[w,t]),(0,r.createElement)("div",{className:"flex flex-col items-center justify-center w-full mt-8"},v&&100===k&&(0,r.createElement)("div",{className:"w-full mb-6 text-center relative"},(0,r.createElement)("button",{onClick:()=>{E(!1),localStorage.setItem("linkboss_sync_complete_banner_dismissed","true")},className:"absolute top-0 right-0 text-gray-400 hover:text-gray-600 dark:text-gray-500 dark:hover:text-gray-300 transition-colors","aria-label":(0,n.__)("Dismiss","semantic-linkboss")},(0,r.createElement)("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20"},(0,r.createElement)("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"}))),(0,r.createElement)("p",{className:"text-base font-medium text-green-600 dark:text-green-400 mb-3"},(0,n.__)("Sync Complete! Your content is ready. Build internal links in the LinkBoss App.","semantic-linkboss")),(0,r.createElement)("button",{onClick:()=>window.open("https://app.linkboss.io/app/sites","_blank"),className:"inline-flex items-center gap-2 bg-green-600 text-white hover:bg-green-700 focus:ring-4 focus:outline-none focus:ring-green-300 font-medium rounded-lg text-sm px-5 py-2.5 transition-colors dark:bg-green-700 dark:hover:bg-green-800"},(0,n.__)("Open LinkBoss App","semantic-linkboss"))),(0,r.createElement)("div",{className:"relative flex flex-col items-center justify-center w-full border-2 border-gray-300 border-dashed rounded-lg dark:bg-gray-900 dark:border-gray-600"},(0,r.createElement)("div",{className:"flex flex-col items-center justify-center pt-20 pb-20 px-4"},(0,r.createElement)(p,{value:k,text:`${k}%`,className:"w-36 h-36 mb-6",styles:(B={pathColor:`rgba(88, 80, 236, ${k/100})`,textColor:"#5850ec",trailColor:"#d6d6d6"},S=B.rotation,L=B.strokeLinecap,R=B.textColor,W=B.textSize,A=B.pathColor,O=B.pathTransition,T=B.pathTransitionDuration,I=B.trailColor,M=B.backgroundColor,j=null==S?void 0:"rotate("+S+"turn)",z=null==S?void 0:"center center",{root:{},path:m({stroke:A,strokeLinecap:L,transform:j,transformOrigin:z,transition:O,transitionDuration:null==T?void 0:T+"s"}),trail:m({stroke:I,strokeLinecap:L,transform:j,transformOrigin:z}),text:m({fill:R,fontSize:W}),background:m({fill:M})})}),(0,r.createElement)("p",{className:"mb-4 text-sm text-gray-500 dark:text-white"},(0,r.createElement)("span",{className:"font-semibold"},(0,n.__)("Click the Sync Now","semantic-linkboss"))," ",(0,n.__)("button for syncing the prepared contents, process may take a while.","semantic-linkboss")),(0,r.createElement)("div",{className:"flex items-center"},(0,r.createElement)("input",{type:"checkbox",className:"w-4 h-4 m-0 text-blue-600 bg-gray-100 border-gray-300 rounded-sm focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600",checked:_,onChange:e=>x(e.target.checked)}),(0,r.createElement)("label",{className:"ms-2 text-sm font-medium text-gray-900 dark:text-gray-300"},(0,n.__)("Force Sync (For Debug Purpose Only)","semantic-linkboss"))),(0,r.createElement)("div",{className:"flex items-center justify-center mt-6"},(0,r.createElement)("button",{className:"flex items-center gap-2 rounded-md bg-indigo-700 py-3 px-6 border text-sm font-bold text-white transition-all shadow-md hover:shadow-lg focus:bg-indigo-700 active:bg-indigo-700 hover:bg-indigo-800 disabled:pointer-events-none disabled:opacity-50 dark:border-indigo-700",onClick:async()=>{if(d([]),c(!0),u?.queue_remaining>0)try{console.log("Preparing queue..."),await(async()=>{try{for(;;){const e=await a.A.post(LinkBossConfig?.rest_url+"linkboss/v1/init/set",{action:"init_posts_ids_batch"},{headers:{"X-WP-Nonce":LinkBossConfig.nonce}});if(await s(),d([`Preparing... ${u?.queue_remaining} posts left.`]),!0!==e?.data?.has_post){console.log("Queue completed."),d(e=>[...e,"Queue preparation completed."]);break}}}catch(e){throw d(e=>[...e,"Error preparing queue..."]),console.error("Error preparing queue:",e),e}})(),console.log("Queue preparation completed.")}catch(e){return console.error("Queue preparation failed:",e),void d(e=>[...e,"Queue preparation failed."])}if(100===k&&!_)return i().fire({icon:"info",title:"Sync Completed",text:"Your data is already synced.",timer:3e3,timerProgressBar:!0}),e&&setTimeout(()=>{localStorage.setItem("linkboss_setup_wizard_step",2),s()},3e3),void c(!1);try{console.log("Starting sync..."),await(async()=>{try{const e=await(async()=>{try{const e=await a.A.post(LinkBossConfig?.rest_url+"linkboss/v1/init",{action:"init_batch_reports",who:"syncPosts"},{headers:{"X-WP-Nonce":LinkBossConfig.nonce}}),t="urls"===e?.data?.reports?.sync_method;return{posts:t?e?.data?.reports?.urls:e?.data?.reports?.posts,pages:t?0:e?.data?.reports?.pages,category:e?.data?.reports?.total_categories,sync_done:e?.data?.reports?.sync_done,sync_method:e?.data?.reports?.sync_method}}catch(e){throw console.error("Error fetching reports:",e),e}})();await(async e=>{try{const t=await a.A.post(LinkBossConfig?.rest_url+"linkboss/v1/sync",{action:"sync_init",force_data:_?"yes":"no",...e},{headers:{"X-WP-Nonce":LinkBossConfig.nonce}});if("success"===t?.data?.status){d(e=>[...e,"Syncing ...","Sync Initiated","Syncing Posts..."]);let e=t?.data?.batch?.length;d(e=>[...e,"Processing batches..."]),await P(e)}else i().fire({icon:"error",title:t?.data?.title,text:t?.data?.message})}catch(e){throw i().fire({icon:"error",title:"Error",text:e?.response?.data.message}),e}})(e)}catch(e){if(console.error("Error syncing posts:",e),"rest_no_route"===e?.response?.data?.code)return void i().fire({title:"Oops!",text:(0,n.__)("Please connect your WordPress site with LinkBoss app by adding the API key from Settings.","semantic-linkboss"),icon:"info",showCancelButton:!0,confirmButtonText:"API Settings",cancelButtonText:"Cancel"}).then(e=>{e.isConfirmed&&(window.location.href="admin.php?page=semantic-linkboss#settings")});i().fire({icon:"info",title:"Oops!",text:e?.response?.data?.message+" - "+e?.response?.data?.code})}})(),console.log("Sync completed successfully.")}catch(e){console.error("Error during sync process:",e),d(e=>[...e,"Error during sync process"])}finally{c(!1)}},disabled:o},(0,r.createElement)(h.g,{icon:y.rk5}),o?(0,n.__)("Syncing...","semantic-linkboss"):(0,n.__)("Sync Now","semantic-linkboss")))),(0,r.createElement)("div",{className:"absolute top-0 right-0 p-3"},(0,r.createElement)("ul",{className:"max-w-md space-y-1 text-gray-500 list-inside dark:text-gray-400"},l.map((e,t)=>(0,r.createElement)("li",{key:t,className:"flex items-center"},(0,r.createElement)(h.g,{icon:y.SGM,className:"w-3.5 h-3.5 me-2 text-green-500 dark:text-green-400 shrink-0"}),e))))));var B,S,L,R,W,A,O,T,I,M,j,z}}}]);