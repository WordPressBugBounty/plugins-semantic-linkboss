"use strict";(globalThis.webpackChunksemantic_linkboss=globalThis.webpackChunksemantic_linkboss||[]).push([[995],{8995:(e,t,r)=>{r.r(t),r.d(t,{default:()=>p});var a=r(1609),s=r(7723),o=r(1083),n=r(8465),i=r.n(n),c=r(5237),l=r(513),d=r(982),u=r(6188);const p=({isWizard:e=!1})=>{const{resetQuery:t}=(0,a.useContext)(l.B),{triggerRefresh:r}=(0,a.useContext)(l.B),[n,p]=(0,a.useState)(!1),[g,m]=(0,a.useState)([]),[h,y]=(0,a.useState)([]),[f,k]=(0,a.useState)(0),[b,_]=(0,a.useState)(!1),[x,w]=(0,a.useState)(0),C=async t=>{try{const a=await o.A.post(LinkBossConfig?.rest_url+"linkboss/v1/sync",{action:"prepare_batch_for_sync"},{headers:{"X-WP-Nonce":LinkBossConfig.nonce}});if(e||r(),400===a?.data?.data?.srv_status?.status)return void i().fire({icon:"error",title:"Error",html:a?.data?.data?.srv_status?.msg});if("yes"===a?.data?.data?.has_batch){let e=(t-a?.data?.data?.batch_length)/t*100;k(Math.round(100*e)/100),await C(t)}else m((e=>[...e,"Sync Completed"])),k(100),v()}catch(e){i().fire({icon:"error",title:"Error",text:"Error preparing queue. Please try again."}),console.error("Error preparing queue:",e)}},v=async()=>{try{const t=await o.A.post(LinkBossConfig?.rest_url+"linkboss/v1/sync",{action:"sync_finish"},{headers:{"X-WP-Nonce":LinkBossConfig.nonce}});"success"===t?.data?.status?(m((e=>[...e,"Category Sync Finished","Syncing Finished"])),m((e=>[...e,"Sync Finished"])),i().fire({icon:"success",title:t?.data?.title,html:t?.data?.message,timer:3e3,timerProgressBar:!0}),w(!0),e&&setTimeout((()=>{localStorage.setItem("linkboss_setup_wizard_step",2)}),1500),r()):i().fire({icon:"error",title:t?.data?.title,html:t?.data?.message})}catch(e){console.error("Error finishing sync:",e)}};return(0,a.useEffect)((()=>{(async()=>{try{const e=await o.A.post(LinkBossConfig?.rest_url+"linkboss/v1/init",{action:"init_batch_reports",who:"syncPosts-2"},{headers:{"X-WP-Nonce":LinkBossConfig.nonce}});let t=e?.data?.reports?.sync_done,r=e?.data?.reports?.sync_remaing,a=t/(t+r)*100||0;n||k(Math.round(100*a)/100),y(e?.data?.reports)}catch(e){throw console.error("Error fetching reports:",e),e}})()}),[x,t]),(0,a.createElement)("div",{className:"flex items-center justify-center w-full mt-8"},(0,a.createElement)("div",{className:"relative flex flex-col items-center justify-center w-full border-2 border-gray-300 border-dashed rounded-lg dark:bg-gray-900 dark:border-gray-600"},(0,a.createElement)("div",{className:"flex flex-col items-center justify-center pt-20 pb-20 px-4"},(0,a.createElement)(c.QF,{value:f,text:`${f}%`,className:"w-36 h-36 mb-6",styles:(0,c.Hf)({pathColor:`rgba(88, 80, 236, ${f/100})`,textColor:"#5850ec",trailColor:"#d6d6d6"})}),(0,a.createElement)("p",{className:"mb-4 text-sm text-gray-500 dark:text-white"},(0,a.createElement)("span",{className:"font-semibold"},(0,s.__)("Click to Sync Now","semantic-linkboss"))," ",(0,s.__)("for a seamless experience, process may take a while.","semantic-linkboss")),(0,a.createElement)("div",{className:"flex items-center"},(0,a.createElement)("input",{type:"checkbox",className:"w-4 h-4 m-0 text-blue-600 bg-gray-100 border-gray-300 rounded-sm focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600",checked:b,onChange:e=>_(e.target.checked)}),(0,a.createElement)("label",{className:"ms-2 text-sm font-medium text-gray-900 dark:text-gray-300"},(0,s.__)("Force Sync - ","semantic-linkboss"),(0,a.createElement)("a",{className:"text-blue-600 dark:text-blue-500 hover:underline ml-1"},(0,s.__)("(to Sync all posts)","semantic-linkboss")),".")),(0,a.createElement)("div",{className:"flex items-center justify-center mt-6"},(0,a.createElement)("button",{className:"flex items-center gap-2 rounded-md bg-indigo-700 py-3 px-6 border text-sm font-bold text-white transition-all shadow-md hover:shadow-lg focus:bg-indigo-700 active:bg-indigo-700 hover:bg-indigo-800 disabled:pointer-events-none disabled:opacity-50 dark:border-indigo-700",onClick:async()=>{if(m([]),p(!0),h?.queue_remaining>0)try{console.log("Preparing queue..."),await(async()=>{try{for(;;){const e=await o.A.post(LinkBossConfig?.rest_url+"linkboss/v1/init/set",{action:"init_posts_ids_batch"},{headers:{"X-WP-Nonce":LinkBossConfig.nonce}});if(await r(),m([`Preparing... ${h?.queue_remaining} posts left.`]),!0!==e?.data?.has_post){console.log("Queue completed."),m((e=>[...e,"Queue preparation completed."]));break}}}catch(e){throw m((e=>[...e,"Error preparing queue..."])),console.error("Error preparing queue:",e),e}})(),console.log("Queue preparation completed.")}catch(e){return console.error("Queue preparation failed:",e),void m((e=>[...e,"Queue preparation failed."]))}if(100===f&&!b)return i().fire({icon:"info",title:"Sync Completed",text:"Your data is already synced.",timer:3e3,timerProgressBar:!0}),e&&setTimeout((()=>{localStorage.setItem("linkboss_setup_wizard_step",2),r()}),3e3),void p(!1);try{console.log("Starting sync..."),await(async()=>{try{const e=await(async()=>{try{const e=await o.A.post(LinkBossConfig?.rest_url+"linkboss/v1/init",{action:"init_batch_reports",who:"syncPosts"},{headers:{"X-WP-Nonce":LinkBossConfig.nonce}});return{posts:e?.data?.reports?.posts,pages:e?.data?.reports?.pages,category:e?.data?.reports?.total_categories,sync_done:e?.data?.reports?.sync_done}}catch(e){throw console.error("Error fetching reports:",e),e}})();await(async e=>{try{const t=await o.A.post(LinkBossConfig?.rest_url+"linkboss/v1/sync",{action:"sync_init",force_data:b?"yes":"no",...e},{headers:{"X-WP-Nonce":LinkBossConfig.nonce}});if("success"===t?.data?.status){m((e=>[...e,"Syncing ...","Sync Initiated","Syncing Posts..."]));let e=t?.data?.batch?.length;m((e=>[...e,"Processing batches..."])),await C(e)}else i().fire({icon:"error",title:t?.data?.title,text:t?.data?.message})}catch(e){throw i().fire({icon:"error",title:"Error",text:e?.response?.data.message}),e}})(e)}catch(e){if(console.error("Error syncing posts:",e),"rest_no_route"===e?.response?.data?.code)return void i().fire({title:"Oops!",text:(0,s.__)("Please connect your WordPress site with LinkBoss app by adding the API key from Settings.","semantic-linkboss"),icon:"info",showCancelButton:!0,confirmButtonText:"Settings",cancelButtonText:"Cancel"}).then((e=>{e.isConfirmed&&document.querySelector('li[data-value="settings"]').click()}));i().fire({icon:"info",title:"Oops!",text:e?.response?.data?.message+" - "+e?.response?.data?.code})}})(),console.log("Sync completed successfully.")}catch(e){console.error("Error during sync process:",e),m((e=>[...e,"Error during sync process"]))}finally{p(!1)}},disabled:n},(0,a.createElement)(d.g,{icon:u.rk5}),n?(0,s.__)("Syncing...","semantic-linkboss"):(0,s.__)("Sync Now","semantic-linkboss")))),(0,a.createElement)("div",{className:"absolute top-0 right-0 p-3"},(0,a.createElement)("ul",{className:"max-w-md space-y-1 text-gray-500 list-inside dark:text-gray-400"},g.map(((e,t)=>(0,a.createElement)("li",{key:t,className:"flex items-center"},(0,a.createElement)(d.g,{icon:u.SGM,className:"w-3.5 h-3.5 me-2 text-green-500 dark:text-green-400 shrink-0"}),e)))))))}},5237:(e,t,r)=>{r.d(t,{Hf:()=>l,QF:()=>c});var a=r(1609),s=function(e,t){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},s(e,t)};function o(e){var t=e.className,r=e.counterClockwise,s=e.dashRatio,o=e.pathRadius,c=e.strokeWidth,l=e.style;return(0,a.createElement)("path",{className:t,style:Object.assign({},l,i({pathRadius:o,dashRatio:s,counterClockwise:r})),d:n({pathRadius:o,counterClockwise:r}),strokeWidth:c,fillOpacity:0})}function n(e){var t=e.pathRadius,r=e.counterClockwise?1:0;return"\n      M 50,50\n      m 0,-"+t+"\n      a "+t+","+t+" "+r+" 1 1 0,"+2*t+"\n      a "+t+","+t+" "+r+" 1 1 0,-"+2*t+"\n    "}function i(e){var t=e.counterClockwise,r=e.dashRatio,a=e.pathRadius,s=2*Math.PI*a,o=(1-r)*s;return{strokeDasharray:s+"px "+s+"px",strokeDashoffset:(t?-o:o)+"px"}}var c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return function(e,t){function __(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(__.prototype=t.prototype,new __)}(t,e),t.prototype.getBackgroundPadding=function(){return this.props.background?this.props.backgroundPadding:0},t.prototype.getPathRadius=function(){return 50-this.props.strokeWidth/2-this.getBackgroundPadding()},t.prototype.getPathRatio=function(){var e=this.props,t=e.value,r=e.minValue,a=e.maxValue;return(Math.min(Math.max(t,r),a)-r)/(a-r)},t.prototype.render=function(){var e=this.props,t=e.circleRatio,r=e.className,s=e.classes,n=e.counterClockwise,i=e.styles,c=e.strokeWidth,l=e.text,d=this.getPathRadius(),u=this.getPathRatio();return(0,a.createElement)("svg",{className:s.root+" "+r,style:i.root,viewBox:"0 0 100 100","data-test-id":"CircularProgressbar"},this.props.background?(0,a.createElement)("circle",{className:s.background,style:i.background,cx:50,cy:50,r:50}):null,(0,a.createElement)(o,{className:s.trail,counterClockwise:n,dashRatio:t,pathRadius:d,strokeWidth:c,style:i.trail}),(0,a.createElement)(o,{className:s.path,counterClockwise:n,dashRatio:u*t,pathRadius:d,strokeWidth:c,style:i.path}),l?(0,a.createElement)("text",{className:s.text,style:i.text,x:50,y:50},l):null)},t.defaultProps={background:!1,backgroundPadding:0,circleRatio:1,classes:{root:"CircularProgressbar",trail:"CircularProgressbar-trail",path:"CircularProgressbar-path",text:"CircularProgressbar-text",background:"CircularProgressbar-background"},counterClockwise:!1,className:"",maxValue:100,minValue:0,strokeWidth:8,styles:{root:{},trail:{},path:{},text:{},background:{}},text:""},t}(a.Component);function l(e){var t=e.rotation,r=e.strokeLinecap,a=e.textColor,s=e.textSize,o=e.pathColor,n=e.pathTransition,i=e.pathTransitionDuration,c=e.trailColor,l=e.backgroundColor,u=null==t?void 0:"rotate("+t+"turn)",p=null==t?void 0:"center center";return{root:{},path:d({stroke:o,strokeLinecap:r,transform:u,transformOrigin:p,transition:n,transitionDuration:null==i?void 0:i+"s"}),trail:d({stroke:c,strokeLinecap:r,transform:u,transformOrigin:p}),text:d({fill:a,fontSize:s}),background:d({fill:l})}}function d(e){return Object.keys(e).forEach((function(t){null==e[t]&&delete e[t]})),e}}}]);